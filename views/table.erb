<%= notice_info %>

<div class='panel panel-default'>
  <div class='panel-heading'>
    <h3 class='panel-title'>
      <%= params[:table_name] %>

      <span class='pull-right'>
        <form id='panel_form' method='post'>
          <input type='hidden' name='_method' value='delete' />
        </form>

        <li class='dropdown' style='display: block;'>
          <a href='#' class='dropdown-toggle' data-toggle='dropdown' aria-expanded='true'>Destroy <span class='caret'></span></a>

          <ul class='dropdown-menu' role='menu'>
            <li><a href='#' onclick="$('#panel_form').attr('action', '<%= "#{request.path_info}/delete_all"%>');$('#panel_form').submit();">Delete All Data</a></li>
            <li><a href='#' onclick="$('#panel_form').attr('action', '<%= "#{request.path_info}/truncate"%>');$('#panel_form').submit();">Truncate Table</a></li>
            <li><a href='#' onclick="$('#panel_form').attr('action', '<%= "#{request.path_info}/drop"%>');$('#panel_form').submit();">Drop Table</a></li>
          </ul>
        </li>
      </span>
    </h3>
  </div>

  <% unless @schema.nil? %>
    <div class='panel-body'>
      <a href='#'>Schema</a>
      <br>
      <b>Columns</b>
      <br>
      <% @schema.each do |column| %>
        <%= "&nbsp;&nbsp;&nbsp;&nbsp;<span class='text-danger'>#{column[0]}</span> <span class='text-primary'>#{column[1][:db_type]}</span>, <span class='text-warning'>#{column[1][:primary_key] ? 'primary_key,' : ''}</span> #{column[1][:allow_null] ? '' : 'not null,'}  <span class='text-success'>#{column[1][:default] ? "default: #{column[1][:default]}" : ''}</span> " %>
        <br>
      <% end %>
      <b>Indexes</b>
      <br>
      <% DB.indexes(params[:table_name]).each do |index_name, index_details| %>
        <%= "&nbsp;&nbsp;&nbsp;&nbsp;<span class='text-danger'>#{index_name}</span> <span class='text-success'>columns: #{index_details[:columns]}</span> " %>
        <% index_details.delete(:columns) %>
        <% index_details.each do |k, v| %>
          <%= "#{k}: #{v}" if v %>
        <% end %>
        <br>
      <% end %>
    </div>
  <% end %>

  <table class='table'>
    <thead>
      <% @dataset.columns.each do |column| %>
        <th>
          <%= column %>
        </th>
      <% end %>
    </thead>

    <tbody>
      <% @dataset.each do |row| %>
        <tr>
          <% @dataset.columns.each_with_index do |column, i| %>
            <td>
              <%= row[column].is_a?(String) ? long_string_become_short(row[column]) : row[column] %>
            </td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>

  <%= erb :pagination%>
</div>